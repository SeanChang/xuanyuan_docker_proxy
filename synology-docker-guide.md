# ç¾¤æ™–NASä½¿ç”¨è½©è¾•é•œåƒé…ç½®DockeråŠ é€Ÿ

åœ¨ç¾¤æ™–NASä¸­é…ç½®Dockerä½¿ç”¨è½©è¾•é•œåƒåŠ é€ŸæœåŠ¡ï¼Œäº«å—é«˜é€Ÿç¨³å®šçš„é•œåƒæ‹‰å–ä½“éªŒ

## å¿«é€Ÿè·³è½¬

- [ç¾¤æ™– NAS ä½¿ç”¨ Docker Compose æ•™ç¨‹](#ç¾¤æ™–nasä½¿ç”¨docker-composeæ•™ç¨‹)
- [ç¾¤æ™– NAS Docker é•œåƒåŠ é€Ÿé…ç½®](#ç¾¤æ™–-nas-docker-é•œåƒåŠ é€Ÿé…ç½®)

## ç¾¤æ™– NAS Docker é•œåƒåŠ é€Ÿé…ç½®

ç¾¤æ™– NAS ç”¨æˆ·å¯ä»¥é€šè¿‡é…ç½® Docker é•œåƒä»“åº“æ¥ä½¿ç”¨é•œåƒåŠ é€ŸæœåŠ¡ã€‚è¯·æŒ‰ç…§ä¸‹æ–¹æ­¥éª¤è¿›è¡Œæ“ä½œï¼Œé…ç½®å®Œæˆåå³å¯äº«å—é«˜é€Ÿçš„é•œåƒæ‹‰å–æœåŠ¡ã€‚

é…ç½®å‰è¯·ç¡®ä¿æ‚¨å·²åœ¨ä¸ªäººä¸­å¿ƒè·å–äº†é•œåƒè´¦æˆ·å’Œå¯†ç ã€‚ç¾¤æ™–NASæ¨èä½¿ç”¨ç™»å½•æ–¹å¼ï¼Œæä¾›æ›´å¥½çš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚

## ç¾¤æ™– NAS Docker é…ç½®æ­¥éª¤

ç¾¤æ™– NAS ç”¨æˆ·å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤é…ç½® Docker é•œåƒä»“åº“ï¼š

### ç¾¤æ™– NAS Docker é•œåƒä»“åº“é…ç½®æ­¥éª¤ï¼ˆæ“ä½œå›¾ç‰‡ï¼‰

![ç¾¤æ™–NAS Dockeré…ç½®](https://imgs.xuanyuan.run/img/synology-docker-0516.jpg)

## è¯¦ç»†é…ç½®æ­¥éª¤

åœ¨ç¾¤æ™– NAS çš„ Docker åº”ç”¨ä¸­é…ç½®é•œåƒä»“åº“ï¼š

1. æ‰“å¼€ç¾¤æ™– DSM æ§åˆ¶é¢æ¿
2. è¿›å…¥"å¥—ä»¶ä¸­å¿ƒ"ï¼Œå®‰è£… Docker å¥—ä»¶ï¼ˆå¦‚æœå°šæœªå®‰è£…ï¼‰
3. æ‰“å¼€ Docker åº”ç”¨
4. ç‚¹å‡»å·¦ä¾§çš„"æ³¨å†Œè¡¨"
5. ç‚¹å‡»å³ä¸Šè§’çš„"è®¾ç½®"æŒ‰é’®
6. åœ¨è®¾ç½®çª—å£ä¸­ï¼Œç‚¹å‡»"æ·»åŠ "æŒ‰é’®
7. å¡«å†™æ³¨å†Œè¡¨ä¿¡æ¯ï¼š
   - **æ³¨å†Œè¡¨ URL**ï¼š`docker.xuanyuan.run`
   - **ç”¨æˆ·å**ï¼šæ‚¨çš„é•œåƒè´¦æˆ·ï¼ˆåœ¨ä¸ªäººä¸­å¿ƒçš„ã€Œç”¨æˆ·ä¿¡æ¯ã€é¡µé¢æŸ¥çœ‹ï¼‰
   - **å¯†ç **ï¼šæ‚¨çš„é•œåƒå¯†ç ï¼ˆåœ¨ä¸ªäººä¸­å¿ƒçš„ã€Œç”¨æˆ·ä¿¡æ¯ã€é¡µé¢æŸ¥çœ‹ï¼‰
8. ç‚¹å‡»"æµ‹è¯•è¿æ¥"ç¡®è®¤é…ç½®æ­£ç¡®
9. ç‚¹å‡»"ä¿å­˜"å®Œæˆé…ç½®

âœ… **é…ç½®æˆåŠŸæç¤º**ï¼šå¦‚æœæµ‹è¯•è¿æ¥æˆåŠŸï¼Œè¯´æ˜é…ç½®æ­£ç¡®ã€‚ä¹‹åæ‚¨å°±å¯ä»¥é€šè¿‡è½©è¾•é•œåƒä»“åº“å¿«é€Ÿæ‹‰å–å„ç§ Docker é•œåƒäº†ã€‚

ğŸ’¡ **å°è´´å£«**ï¼šä½¿ç”¨è½©è¾•é•œåƒåŠ é€Ÿåœ°å€ï¼š
- ç™»å½•åœ°å€ï¼š`docker.xuanyuan.run`

## æ—¥å¸¸ä½¿ç”¨è¯´æ˜

é…ç½®å®Œæˆåçš„æ—¥å¸¸ä½¿ç”¨æ–¹æ³•

### åç»­æ‹‰å–é•œåƒï¼š

1. åœ¨ Docker åº”ç”¨ä¸­ï¼Œç‚¹å‡»å·¦ä¾§çš„"æ˜ åƒ"
2. ç‚¹å‡»å³ä¸Šè§’çš„"æ·»åŠ "æŒ‰é’®
3. é€‰æ‹©"ä» Docker Hub æ·»åŠ "
4. åœ¨æœç´¢æ¡†ä¸­è¾“å…¥é•œåƒåç§°
5. é€‰æ‹©éœ€è¦çš„é•œåƒç‰ˆæœ¬
6. ç‚¹å‡»"é€‰æ‹©"å¼€å§‹ä¸‹è½½

ğŸ’¡ **å°è´´å£«**ï¼šé…ç½®å®Œæˆåï¼Œç¾¤æ™– NAS ä¼šè‡ªåŠ¨ä½¿ç”¨è½©è¾•é•œåƒåŠ é€ŸæœåŠ¡æ‹‰å–é•œåƒï¼Œå¤§å¤§æå‡ä¸‹è½½é€Ÿåº¦å’Œç¨³å®šæ€§ã€‚æ‚¨å¯ä»¥åœ¨ä¸‹è½½è¿‡ç¨‹ä¸­çœ‹åˆ°æ˜æ˜¾çš„é€Ÿåº¦æå‡ã€‚

## æµé‡è€—å°½é”™è¯¯æç¤º

å½“æ‚¨çš„æµé‡ç”¨å°½æ—¶ï¼Œæ‹‰å–é•œåƒä¼šæ˜¾ç¤ºä»¥ä¸‹é”™è¯¯ï¼Œè¯·åŠæ—¶å……å€¼ï¼š

```bash
docker pull docker.xuanyuan.run/redis
Using default tag: latest
Error response from daemon: unknown: {"errors":[{"code":"PAYMENT_REQUIRED","message":"capacity has use up","detail":[{"Type":"repository","Name":"library/*","Action":"pull"}]}]}
```

ğŸ’¡ å½“æ‚¨ç™»å½•æˆ–æ‹‰å–é•œåƒæ—¶è¿”å› 402 Payment Required é”™è¯¯ï¼Œè¡¨ç¤ºæ‚¨çš„æµé‡å·²è€—å°½ã€‚è¯·ç«‹å³å……å€¼æµé‡åŒ…ä»¥ç»§ç»­ä½¿ç”¨é•œåƒåŠ é€ŸæœåŠ¡ã€‚

## ç¾¤æ™–NASä½¿ç”¨Docker Composeæ•™ç¨‹

ç¾¤æ™–DMS7.2ç‰ˆæœ¬åå°†è‡ªå·±çš„Dockeræ”¹åå®¹å™¨æœåŠ¡ï¼Œå¥—ä»¶ä¸­å¿ƒé‡Œå«ã€ŒContainer Managerã€ã€‚è™½ç„¶æä¾›äº†å›¾å½¢ç•Œé¢ï¼Œä½†ç»ˆç«¯è®¾ç½®ä¸ç”Ÿæ•ˆï¼Œå¦‚éœ€ä½¿ç”¨docker composeç­‰å‘½ä»¤ï¼Œéœ€è¦æ‰‹åŠ¨ç¼–è¾‘é…ç½®æ–‡ä»¶ã€‚

**ç‰ˆæœ¬è¯´æ˜**ï¼šDMS7.2+ç‰ˆæœ¬ä¸­ï¼ŒDockerå¥—ä»¶å·²æ›´åä¸ºã€ŒContainer Managerã€ï¼Œæ—§ç‰ˆç³»ç»Ÿè¯·å°†é…ç½®æ–‡ä»¶è·¯å¾„ä¸­çš„ContainerManageræ›¿æ¢ä¸ºDockerã€‚

### é…ç½®æ–‡ä»¶è·¯å¾„ï¼š

- **DMS7.2+ç‰ˆæœ¬**ï¼š`/var/packages/ContainerManager/etc/dockerd.json`
- **æ—§ç‰ˆç³»ç»Ÿ**ï¼š`/var/packages/Docker/etc/dockerd.json`

### æŸ¥çœ‹å½“å‰é…ç½®ï¼š

é¦–å…ˆæŸ¥çœ‹ç°æœ‰çš„é…ç½®æ–‡ä»¶å†…å®¹ï¼š

**DMS7.2+ç‰ˆæœ¬**
```bash
sudo cat /var/packages/ContainerManager/etc/dockerd.json
```

**æ—§ç‰ˆç³»ç»Ÿ**
```bash
sudo cat /var/packages/Docker/etc/dockerd.json
```

### é…ç½®ç¤ºä¾‹ï¼š

å½“å‰é…ç½®æ–‡ä»¶å¯èƒ½åŒ…å«å¤šä¸ªé•œåƒæºï¼Œå»ºè®®ä¿ç•™é»˜è®¤è®¾ç½®ï¼Œä»…ä¿®æ”¹registry-mirrorséƒ¨åˆ†ï¼š

**æ¨èé…ç½®**
```json
{
    "registry-mirrors": [
        "https://xxx.xuanyuan.run"
    ],
    "data-root": "/var/packages/ContainerManager/var/docker",
    "log-driver": "db",
    "storage-driver": "btrfs"
}
```

> **æ³¨æ„**ï¼šè¯·å°† `xxx.xuanyuan.run` æ›¿æ¢ä¸ºæ‚¨çš„å…ç™»å½•åŸŸå

### é‡å¯DockeræœåŠ¡ï¼š

ä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œéœ€è¦é‡å¯DockeræœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆï¼š

**DMS7.2+ç‰ˆæœ¬**
```bash
/var/packages/ContainerManager/scripts/start-stop-status stop
/var/packages/ContainerManager/scripts/start-stop-status start
```

**æ—§ç‰ˆç³»ç»Ÿ**
```bash
/var/packages/Docker/scripts/start-stop-status stop
/var/packages/Docker/scripts/start-stop-status start
```

âœ… **é…ç½®éªŒè¯**ï¼šé‡å¯æœåŠ¡åï¼Œæ‚¨å°±å¯ä»¥åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨ docker compose ç­‰å‘½ä»¤ï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨ä½¿ç”¨è½©è¾•é•œåƒåŠ é€ŸæœåŠ¡ï¼Œäº«å—ä¸æ»‘çš„Dockeræ“ä½œä½“éªŒã€‚
